#!/bin/bash
# backup script for {{ item.src }}
{% if restic_global_pre %}{{ restic_global_pre }}{% endif %}

export RESTIC_PASSWORD="{{ item.password | mandatory }}"
export RESTIC_REPOSITORY="{{ item.dest }}"

/opt/restic backup \
    {% if 'exclude' in item %}--exclude-file=/root/backup-scripts/{{ item.name }}-exclude.txt \{% endif %}
    {{ item.dest }}

/opt/restic forget --prune --keep-daily {{ item.keep_schedule.daily }} --keep-weekly {{ item.keep_schedule.weekly }} --keep-monthly {{ item.keep_schedule.monthly }}

{% if restic_global_post %}{{ restic_global_post }}{% endif %}
